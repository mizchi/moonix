// Generated by moon-component
// Import module: wasi:io/poll@0.2.9

///|
pub(all) struct Pollable(Int) derive(Show, Eq)

///| Low-level FFI import
fn ffi_pollable_block(p0 : Int) -> Unit = "wasi:io/poll@0.2.9" "[method]pollable.block"

///| High-level wrapper with canonical ABI conversion
pub fn pollable_block(handle : Pollable) -> Unit {
  ffi_pollable_block(handle.0)
}

///| Low-level FFI import
fn ffi_pollable_ready(p0 : Int) -> Int = "wasi:io/poll@0.2.9" "[method]pollable.ready"

///| High-level wrapper with canonical ABI conversion
pub fn pollable_ready(handle : Pollable) -> Bool {
  let result = ffi_pollable_ready(handle.0)
  result != 0
}

///| Low-level FFI import
fn ffi_poll(p0_ptr : Int, p0_len : Int, retptr : Int) -> Int = "wasi:io/poll@0.2.9" "poll"

///| High-level wrapper with canonical ABI conversion
pub fn poll(pollables : Array[Pollable]) -> Array[UInt] {
  let p0_len = pollables.length()
  let p0_ptr = @cabi.cabi_realloc(0, 0, 4, p0_len * 4)
  for i, elem in pollables {
    let elem_ptr = p0_ptr + i * 4
    @cabi.cabi_write_i32(elem_ptr, elem.0)
  }
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_poll(p0_ptr, p0_len, retptr)
  let result_ptr = @cabi.cabi_read_i32(retptr)
  let result_len = @cabi.cabi_read_i32(retptr + 4)
  let result : Array[UInt] = {
    let arr : Array[UInt] = Array::new(capacity=result_len)
    for i = 0; i < result_len; i = i + 1 {
      let elem_ptr = result_ptr + i * 4
      arr.push(@cabi.cabi_read_i32(elem_ptr).reinterpret_as_uint())
    }
    arr
  }
  result
}

