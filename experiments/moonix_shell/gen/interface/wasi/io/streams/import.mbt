// Generated by moon-component
// Import module: wasi:io/streams@0.2.9

///|
pub(all) struct InputStream(Int) derive(Show, Eq)

///|
pub(all) struct OutputStream(Int) derive(Show, Eq)

///|
pub(all) enum StreamError {
  LastOperationFailed(@error.IoError)
  Closed
} derive(Show, Eq)

///| Low-level FFI import
fn ffi_input_stream_blocking_read(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]input-stream.blocking-read"

///| High-level wrapper with canonical ABI conversion
pub fn input_stream_blocking_read(handle : InputStream, len : UInt64) -> Result[Array[Byte], StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_input_stream_blocking_read(handle.0, len.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => {
      let data_ptr = @cabi.cabi_read_i32(retptr + 4)
      let data_len = @cabi.cabi_read_i32(retptr + 8)
      let bytes : Array[Byte] = Array::new(capacity=data_len)
      for i in 0..<data_len {
        bytes.push(@cabi.cabi_read_u8(data_ptr + i))
      }
      Ok(bytes)
    }
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_input_stream_blocking_skip(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]input-stream.blocking-skip"

///| High-level wrapper with canonical ABI conversion
pub fn input_stream_blocking_skip(handle : InputStream, len : UInt64) -> Result[UInt64, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_input_stream_blocking_skip(handle.0, len.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_input_stream_read(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]input-stream.read"

///| High-level wrapper with canonical ABI conversion
pub fn input_stream_read(handle : InputStream, len : UInt64) -> Result[Array[Byte], StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_input_stream_read(handle.0, len.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => {
      let data_ptr = @cabi.cabi_read_i32(retptr + 4)
      let data_len = @cabi.cabi_read_i32(retptr + 8)
      let bytes : Array[Byte] = Array::new(capacity=data_len)
      for i in 0..<data_len {
        bytes.push(@cabi.cabi_read_u8(data_ptr + i))
      }
      Ok(bytes)
    }
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_input_stream_skip(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]input-stream.skip"

///| High-level wrapper with canonical ABI conversion
pub fn input_stream_skip(handle : InputStream, len : UInt64) -> Result[UInt64, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_input_stream_skip(handle.0, len.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_input_stream_subscribe(p0 : Int) -> Int = "wasi:io/streams@0.2.9" "[method]input-stream.subscribe"

///| High-level wrapper with canonical ABI conversion
pub fn input_stream_subscribe(handle : InputStream) -> @poll.Pollable {
  let result = ffi_input_stream_subscribe(handle.0)
  @poll.Pollable(result)
}

///| Low-level FFI import
fn ffi_output_stream_blocking_flush(p0 : Int, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.blocking-flush"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_blocking_flush(handle : OutputStream) -> Result[Unit, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_blocking_flush(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_output_stream_blocking_splice(p0 : Int, p1 : Int, p2 : Int64, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.blocking-splice"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_blocking_splice(handle : OutputStream, src : InputStream, len : UInt64) -> Result[UInt64, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_blocking_splice(handle.0, src.0, len.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_output_stream_blocking_write_and_flush(p0 : Int, p1_ptr : Int, p1_len : Int, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.blocking-write-and-flush"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_blocking_write_and_flush(handle : OutputStream, contents : Array[Byte]) -> Result[Unit, StreamError] {
  let p1_len = contents.length()
  let p1_ptr = @cabi.cabi_realloc(0, 0, 1, p1_len * 1)
  for i, elem in contents {
    let elem_ptr = p1_ptr + i * 1
    @cabi.cabi_write_u8(elem_ptr, elem)
  }
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_blocking_write_and_flush(handle.0, p1_ptr, p1_len, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_output_stream_blocking_write_zeroes_and_flush(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.blocking-write-zeroes-and-flush"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_blocking_write_zeroes_and_flush(handle : OutputStream, len : UInt64) -> Result[Unit, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_blocking_write_zeroes_and_flush(handle.0, len.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_output_stream_check_write(p0 : Int, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.check-write"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_check_write(handle : OutputStream) -> Result[UInt64, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_check_write(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_output_stream_flush(p0 : Int, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.flush"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_flush(handle : OutputStream) -> Result[Unit, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_flush(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_output_stream_splice(p0 : Int, p1 : Int, p2 : Int64, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.splice"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_splice(handle : OutputStream, src : InputStream, len : UInt64) -> Result[UInt64, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_splice(handle.0, src.0, len.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_output_stream_subscribe(p0 : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.subscribe"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_subscribe(handle : OutputStream) -> @poll.Pollable {
  let result = ffi_output_stream_subscribe(handle.0)
  @poll.Pollable(result)
}

///| Low-level FFI import
fn ffi_output_stream_write(p0 : Int, p1_ptr : Int, p1_len : Int, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.write"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_write(handle : OutputStream, contents : Array[Byte]) -> Result[Unit, StreamError] {
  let p1_len = contents.length()
  let p1_ptr = @cabi.cabi_realloc(0, 0, 1, p1_len * 1)
  for i, elem in contents {
    let elem_ptr = p1_ptr + i * 1
    @cabi.cabi_write_u8(elem_ptr, elem)
  }
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_write(handle.0, p1_ptr, p1_len, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

///| Low-level FFI import
fn ffi_output_stream_write_zeroes(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:io/streams@0.2.9" "[method]output-stream.write-zeroes"

///| High-level wrapper with canonical ABI conversion
pub fn output_stream_write_zeroes(handle : OutputStream, len : UInt64) -> Result[Unit, StreamError] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_output_stream_write_zeroes(handle.0, len.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => {
      let err_tag = @cabi.cabi_read_i32(retptr + 4)
      match err_tag {
        0 => Err(LastOperationFailed(@error.IoError(@cabi.cabi_read_i32(retptr + 8))))
        _ => Err(Closed)
      }
    }
  }
}

