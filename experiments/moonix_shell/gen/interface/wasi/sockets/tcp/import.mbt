// Generated by moon-component
// Import module: wasi:sockets/tcp@0.2.9

type Duration = UInt64

type ErrorCode = @network.ErrorCode

type IpSocketAddress = @network.IpSocketAddress

type IpAddressFamily = @network.IpAddressFamily

///|
pub(all) enum ShutdownType {
  Receive
  Send
  Both
} derive(Show, Eq)

///|
pub fn ShutdownType::from_ordinal(ord : Int) -> ShutdownType {
  match ord {
    0 => Receive
    1 => Send
    2 => Both
    _ => abort("invalid ordinal")
  }
}

///|
pub fn ShutdownType::ordinal(self : ShutdownType) -> Int {
  match self {
    Receive => 0
    Send => 1
    Both => 2
  }
}

///|
pub(all) struct TcpSocket(Int) derive(Show, Eq)

///| Low-level FFI import
fn ffi_tcp_socket_accept(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.accept"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_accept(handle : TcpSocket) -> Result[(TcpSocket, @streams.InputStream, @streams.OutputStream), ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 16)
  let _ = ffi_tcp_socket_accept(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok((TcpSocket(@cabi.cabi_read_i32(retptr + 4)), @streams.InputStream(@cabi.cabi_read_i32(retptr + 8)), @streams.OutputStream(@cabi.cabi_read_i32(retptr + 12))))
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_address_family(p0 : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.address-family"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_address_family(handle : TcpSocket) -> IpAddressFamily {
  let result = ffi_tcp_socket_address_family(handle.0)
  IpAddressFamily::from_ordinal(result)
}

///| Low-level FFI import
fn ffi_tcp_socket_finish_bind(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.finish-bind"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_finish_bind(handle : TcpSocket) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_finish_bind(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_finish_connect(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.finish-connect"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_finish_connect(handle : TcpSocket) -> Result[(@streams.InputStream, @streams.OutputStream), ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_tcp_socket_finish_connect(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok((@streams.InputStream(@cabi.cabi_read_i32(retptr + 4)), @streams.OutputStream(@cabi.cabi_read_i32(retptr + 8))))
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_finish_listen(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.finish-listen"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_finish_listen(handle : TcpSocket) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_finish_listen(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_hop_limit(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.hop-limit"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_hop_limit(handle : TcpSocket) -> Result[Byte, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_hop_limit(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_u8(retptr + 4))
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_is_listening(p0 : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.is-listening"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_is_listening(handle : TcpSocket) -> Bool {
  let result = ffi_tcp_socket_is_listening(handle.0)
  result != 0
}

///| Low-level FFI import
fn ffi_tcp_socket_keep_alive_count(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.keep-alive-count"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_keep_alive_count(handle : TcpSocket) -> Result[UInt, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_keep_alive_count(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i32(retptr + 4).reinterpret_as_uint())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_keep_alive_enabled(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.keep-alive-enabled"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_keep_alive_enabled(handle : TcpSocket) -> Result[Bool, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_keep_alive_enabled(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i32(retptr + 4) != 0)
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_keep_alive_idle_time(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.keep-alive-idle-time"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_keep_alive_idle_time(handle : TcpSocket) -> Result[Duration, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_tcp_socket_keep_alive_idle_time(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_keep_alive_interval(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.keep-alive-interval"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_keep_alive_interval(handle : TcpSocket) -> Result[Duration, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_tcp_socket_keep_alive_interval(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_local_address(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.local-address"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_local_address(handle : TcpSocket) -> Result[IpSocketAddress, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 36)
  let _ = ffi_tcp_socket_local_address(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => {
      // TODO: lift IpSocketAddress properly
      abort("tcp_socket_local_address: lift IpSocketAddress not implemented")
    }
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_receive_buffer_size(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.receive-buffer-size"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_receive_buffer_size(handle : TcpSocket) -> Result[UInt64, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_tcp_socket_receive_buffer_size(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_remote_address(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.remote-address"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_remote_address(handle : TcpSocket) -> Result[IpSocketAddress, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 36)
  let _ = ffi_tcp_socket_remote_address(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => {
      // TODO: lift IpSocketAddress properly
      abort("tcp_socket_remote_address: lift IpSocketAddress not implemented")
    }
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_send_buffer_size(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.send-buffer-size"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_send_buffer_size(handle : TcpSocket) -> Result[UInt64, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 12)
  let _ = ffi_tcp_socket_send_buffer_size(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(@cabi.cabi_read_i64(retptr + 4).reinterpret_as_uint64())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_set_hop_limit(p0 : Int, p1 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.set-hop-limit"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_set_hop_limit(handle : TcpSocket, value : Byte) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_set_hop_limit(handle.0, value.to_int(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_set_keep_alive_count(p0 : Int, p1 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.set-keep-alive-count"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_set_keep_alive_count(handle : TcpSocket, value : UInt) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_set_keep_alive_count(handle.0, value.reinterpret_as_int(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_set_keep_alive_enabled(p0 : Int, p1 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.set-keep-alive-enabled"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_set_keep_alive_enabled(handle : TcpSocket, value : Bool) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_set_keep_alive_enabled(handle.0, if value { 1 } else { 0 }, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_set_keep_alive_idle_time(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.set-keep-alive-idle-time"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_set_keep_alive_idle_time(handle : TcpSocket, value : Duration) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_set_keep_alive_idle_time(handle.0, value.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_set_keep_alive_interval(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.set-keep-alive-interval"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_set_keep_alive_interval(handle : TcpSocket, value : Duration) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_set_keep_alive_interval(handle.0, value.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_set_listen_backlog_size(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.set-listen-backlog-size"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_set_listen_backlog_size(handle : TcpSocket, value : UInt64) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_set_listen_backlog_size(handle.0, value.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_set_receive_buffer_size(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.set-receive-buffer-size"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_set_receive_buffer_size(handle : TcpSocket, value : UInt64) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_set_receive_buffer_size(handle.0, value.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_set_send_buffer_size(p0 : Int, p1 : Int64, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.set-send-buffer-size"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_set_send_buffer_size(handle : TcpSocket, value : UInt64) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_set_send_buffer_size(handle.0, value.reinterpret_as_int64(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_shutdown(p0 : Int, p1 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.shutdown"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_shutdown(handle : TcpSocket, shutdown_type : ShutdownType) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_shutdown(handle.0, shutdown_type.ordinal(), retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_start_bind(p0 : Int, p1 : Int, p2 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.start-bind"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_start_bind(handle : TcpSocket, network : @network.Network, local_address : IpSocketAddress) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  // TODO: lower IpSocketAddress properly
  ignore(local_address)
  let _ = ffi_tcp_socket_start_bind(handle.0, network.0, 0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_start_connect(p0 : Int, p1 : Int, p2 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.start-connect"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_start_connect(handle : TcpSocket, network : @network.Network, remote_address : IpSocketAddress) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  // TODO: lower IpSocketAddress properly
  ignore(remote_address)
  let _ = ffi_tcp_socket_start_connect(handle.0, network.0, 0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_start_listen(p0 : Int, retptr : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.start-listen"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_start_listen(handle : TcpSocket) -> Result[Unit, ErrorCode] {
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  let _ = ffi_tcp_socket_start_listen(handle.0, retptr)
  match @cabi.cabi_read_i32(retptr) {
    0 => Ok(())
    _ => Err(ErrorCode::from_ordinal(@cabi.cabi_read_i32(retptr + 4)))
  }
}

///| Low-level FFI import
fn ffi_tcp_socket_subscribe(p0 : Int) -> Int = "wasi:sockets/tcp@0.2.9" "[method]tcp-socket.subscribe"

///| High-level wrapper with canonical ABI conversion
pub fn tcp_socket_subscribe(handle : TcpSocket) -> @poll.Pollable {
  let result = ffi_tcp_socket_subscribe(handle.0)
  @poll.Pollable(result)
}
